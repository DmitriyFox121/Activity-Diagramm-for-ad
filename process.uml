@startuml
|#lightgreen|Пользователь|
start
:Post/API/ver1/ads;

|#lightblue|API|
:Проверка запроса (валидация);
if (Запрос корректен?) then (нет)
 :http 400;
 stop
else (да)
 :CREATE Ad;
 :Выставить обьявлению 
   статус "Prototype";
endif

|#yellow|DB|
:Заполнить данные [INSERT INTO ads];

|#lightblue|API|
fork
  :Отправить обьявление 
   на модерацию;
  fork again
  :Выставить обьявлению 
   статус "Moderation";
   |#yellow|DB|
    :Status - blank;
   |#lightblue|API|
  
 end fork;

|#pink|Kafka Broker|
:Сохранение события в очереди;

|#orange|Модератор|
:Get/API/ver1/moderation/ads;
:Получить новое обьявление;
:Проверитиь обьявление;
if (обьявление соответсвует правилам?) then (нет)
  :POST /API/ver1/moderation/ads/{id}/bad;
  |API|
   :Выставить обьявлению статус "Cancel";
  |DB|
   :Status - cancel;
  |API|
   :Отправить уведомление о провале;
  |Пользователь|
   :Получить обьявление о провальной публикации (http 403);
stop
|Модератор|
else (да)
  :POST /API/ver1/moderation/ads/{id}/good;
  |API|
   :Выставить обьявлению статус "Publish";
  |DB|
   :Status - publish;
  |API|
   :Отправить уведомление об успехе;
  |Пользователь|
   :Получить обьявление об успешной публикации (http 200);
stop
@enduml