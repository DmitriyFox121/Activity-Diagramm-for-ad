@startuml
|#lightgreen|Пользователь|
start
:Post/API/ver1/ads;

|#lightblue|API|
:Проверка запроса (валидация);
if (Запрос корректен?) then (нет)
 :http 400;
 |Пользователь|
  :Получить уведомление;
 stop
|API|
else (да)
 :CREATE Ad;
 :Выставить обьявлению 
   статус "Prototype";
endif

|#yellow|DB|
:Заполнить данные [INSERT INTO ads];
 note right
 Status - blank
 end note

|#lightblue|API|
fork
  :Отправить обьявление 
   на модерацию;
  fork again
  :Выставить обьявлению 
   статус "Moderation";
   |#yellow|DB|
    :Status - on_modereation;
   |#lightblue|API|
  
 end fork;

|#pink|Kafka Broker|
:Сохранение события в очереди;

|#orange|Модератор|
:Get/API/ver1/moderation/ads;
:Получить новое обьявление;
:Проверитиь объявление;
:POST /API/ver1/moderation/ads/{id}/solution;

|API|
:Получить ответ;
if (обьявление соответсвует правилам?) then (нет)
   :Выставить обьявлению статус "Cancel";
  |DB|
   :Status - cancel;
  |API|
   :Отправить уведомление о провале;
else (да)
   :Выставить обьявлению статус "Publish";
  |DB|
   :Status - publish;
  |API|
   :Отправить уведомление об успехе;
|Пользователь|
endif
   :Получить уведомление;
stop
@enduml